<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Envío de Correos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container mt-5">
    <div class="row">
      <div class="col-md-12 mb-4">
        <h1 class="text-center">Sistema de Envío de Correos</h1>
      </div>
    </div>

    <div class="row">
      <div class="col-md-3">
        <div class="card mb-4">
          <div class="card-header">
            <h5>Menú</h5>
          </div>
          <div class="card-body">
            <div class="list-group">
              <a href="#" class="list-group-item list-group-item-action active" id="nav-lists">Listas</a>
              <a href="#" class="list-group-item list-group-item-action" id="nav-campaign">Enviar Campaña</a>
              <a href="#" class="list-group-item list-group-item-action" id="nav-test">Enviar Prueba</a>
              <a href="#" class="list-group-item list-group-item-action" id="nav-stats">Estadísticas</a>
              <a href="#" class="list-group-item list-group-item-action" id="nav-settings">Configuración</a>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-9">
        <!-- Sección de Listas -->
        <div class="card mb-4" id="section-lists">
          <div class="card-header">
            <h5>Listas de Contactos</h5>
          </div>
          <div class="card-body">
            <form id="import-form" enctype="multipart/form-data">
              <div class="mb-3">
                <label for="listName" class="form-label">Nombre de la Lista</label>
                <input type="text" class="form-control" id="listName" name="listName" required>
              </div>
              <div class="mb-3">
                <label for="csvFile" class="form-label">Archivo CSV</label>
                <input type="file" class="form-control" id="csvFile" name="csvFile" accept=".csv" required>
                <div class="form-text">El archivo CSV debe contener al menos una columna 'email'.</div>
              </div>
              <button type="submit" class="btn btn-primary" id="import-btn">
                <span class="spinner-border spinner-border-sm d-none" id="import-spinner" role="status" aria-hidden="true"></span>
                Importar Contactos
              </button>
            </form>
            
            <hr>
            
            <h6 class="mt-4">Listas Existentes</h6>
            <div id="lists-container">
              <div class="text-center py-3">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Cargando...</span>
                </div>
              </div>
            </div>
            
            <div id="subscribers-container" class="mt-4 d-none">
              <h6>Contactos en la lista: <span id="current-list-name"></span></h6>
              
              <div class="d-flex justify-content-between mb-3">
                <button class="btn btn-sm btn-primary" id="btn-add-subscriber">
                  <i class="bi bi-plus-circle"></i> Añadir Contacto
                </button>
                <button class="btn btn-sm btn-secondary" id="btn-back-to-lists">
                  <i class="bi bi-arrow-left"></i> Volver a Listas
                </button>
              </div>
              
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead>
                    <tr>
                      <th>Email</th>
                      <th>Nombre</th>
                      <th>Estado</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="subscribers-list">
                    <!-- Los contactos se cargarán aquí dinámicamente -->
                  </tbody>
                </table>
              </div>
            </div>
            
            <!-- Modal para añadir/editar contacto -->
            <div class="modal fade" id="subscriberModal" tabindex="-1" aria-labelledby="subscriberModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="subscriberModalLabel">Añadir Contacto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <form id="subscriber-form">
                      <input type="hidden" id="subscriber-id">
                      <input type="hidden" id="subscriber-list-id">
                      
                      <div class="mb-3">
                        <label for="subscriber-email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="subscriber-email" required>
                      </div>
                      
                      <div class="mb-3">
                        <label for="subscriber-name" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="subscriber-name">
                      </div>
                      
                      <div id="custom-fields-container">
                        <!-- Campos personalizados se añadirán aquí -->
                      </div>
                      
                      <button type="button" class="btn btn-sm btn-outline-secondary" id="btn-add-custom-field">
                        Añadir Campo Personalizado
                      </button>
                    </form>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="btn-save-subscriber">Guardar</button>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Modal de confirmación para eliminar -->
            <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Confirmar Eliminación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <p>¿Estás seguro de que deseas eliminar este contacto? Esta acción no se puede deshacer.</p>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="btn-confirm-delete">Eliminar</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Sección de Envío de Campaña -->
        <div class="card mb-4 d-none" id="section-campaign">
          <div class="card-header">
            <h5>Enviar Campaña</h5>
          </div>
          <div class="card-body">
            <form id="campaign-form">
              <div class="mb-3">
                <label for="campaignList" class="form-label">Lista de Destinatarios</label>
                <select class="form-select" id="campaignList" name="listId" required>
                  <option value="">Selecciona una lista...</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="campaignProvider" class="form-label">Proveedor de Email</label>
                <select class="form-select" id="campaignProvider" name="provider">
                  <option value="aws-ses">Amazon SES</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="campaignSubject" class="form-label">Asunto</label>
                <input type="text" class="form-control" id="campaignSubject" name="subject" required>
              </div>
              <div class="mb-3">
                <label for="campaignMessage" class="form-label">Mensaje</label>
                <textarea class="form-control" id="campaignMessage" name="message" rows="6" required></textarea>
                <div class="form-text">
                  Puedes usar variables como {{nombre}} o cualquier campo personalizado del CSV con {{campo}}.
                </div>
              </div>
              <button type="submit" class="btn btn-primary" id="campaign-btn">
                <span class="spinner-border spinner-border-sm d-none" id="campaign-spinner" role="status" aria-hidden="true"></span>
                Enviar Campaña
              </button>
            </form>
          </div>
        </div>

        <!-- Sección de Envío de Prueba -->
        <div class="card mb-4 d-none" id="section-test">
          <div class="card-header">
            <h5>Enviar Correo de Prueba</h5>
          </div>
          <div class="card-body">
            <form id="test-form">
              <div class="mb-3">
                <label for="testEmail" class="form-label">Correo de Prueba</label>
                <input type="email" class="form-control" id="testEmail" name="to" required>
              </div>
              <div class="mb-3">
                <label for="testProvider" class="form-label">Proveedor de Email</label>
                <select class="form-select" id="testProvider" name="provider">
                  <option value="aws-ses">Amazon SES</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="testSubject" class="form-label">Asunto</label>
                <input type="text" class="form-control" id="testSubject" name="subject" required>
              </div>
              <div class="mb-3">
                <label for="testMessage" class="form-label">Mensaje</label>
                <textarea class="form-control" id="testMessage" name="message" rows="6" required></textarea>
              </div>
              <button type="submit" class="btn btn-primary" id="test-btn">
                <span class="spinner-border spinner-border-sm d-none" id="test-spinner" role="status" aria-hidden="true"></span>
                Enviar Prueba
              </button>
            </form>
          </div>
        </div>

        <!-- Sección de Estadísticas -->
        <div class="card mb-4 d-none" id="section-stats">
          <div class="card-header">
            <h5>Estadísticas de Campañas</h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label for="statsCampaign" class="form-label">ID de Campaña</label>
              <div class="input-group">
                <input type="text" class="form-control" id="statsCampaign" placeholder="Ingresa el ID de la campaña">
                <button class="btn btn-primary" id="stats-btn">
                  <span class="spinner-border spinner-border-sm d-none" id="stats-spinner" role="status" aria-hidden="true"></span>
                  Ver Estadísticas
                </button>
              </div>
            </div>
            
            <div id="stats-container" class="mt-4 d-none">
              <div class="row">
                <div class="col-md-6">
                  <div class="card bg-light">
                    <div class="card-body text-center">
                      <h3 id="stats-total-opens">0</h3>
                      <p class="mb-0">Total de Aperturas</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card bg-light">
                    <div class="card-body text-center">
                      <h3 id="stats-unique-opens">0</h3>
                      <p class="mb-0">Aperturas Únicas</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Sección de Configuración -->
        <div class="card mb-4 d-none" id="section-settings">
          <div class="card-header">
            <h5>Configuración</h5>
          </div>
          <div class="card-body">
            <form id="settings-form">
              <h6 class="mb-3">Amazon SES</h6>
              <div class="mb-3">
                <label for="awsAccessKey" class="form-label">AWS Access Key ID</label>
                <input type="text" class="form-control" id="awsAccessKey" name="AWS_ACCESS_KEY_ID">
              </div>
              <div class="mb-3">
                <label for="awsSecretKey" class="form-label">AWS Secret Access Key</label>
                <input type="password" class="form-control" id="awsSecretKey" name="AWS_SECRET_ACCESS_KEY">
              </div>
              <div class="mb-3">
                <label for="awsRegion" class="form-label">AWS Region</label>
                <input type="text" class="form-control" id="awsRegion" name="AWS_REGION" placeholder="us-east-1">
              </div>
              
              <h6 class="mb-3 mt-4">SendGrid</h6>
              <div class="mb-3">
                <label for="sendgridApiKey" class="form-label">SendGrid API Key</label>
                <input type="password" class="form-control" id="sendgridApiKey" name="SENDGRID_API_KEY">
              </div>
              
              <h6 class="mb-3 mt-4">General</h6>
              <div class="mb-3">
                <label for="emailFrom" class="form-label">Email Remitente</label>
                <input type="email" class="form-control" id="emailFrom" name="EMAIL_FROM">
              </div>
              <div class="mb-3">
                <label for="appUrl" class="form-label">URL de la Aplicación</label>
                <input type="text" class="form-control" id="appUrl" name="APP_URL" placeholder="http://localhost:3000">
              </div>
              
              <button type="submit" class="btn btn-primary" id="settings-btn">
                <span class="spinner-border spinner-border-sm d-none" id="settings-spinner" role="status" aria-hidden="true"></span>
                Guardar Configuración
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Alertas -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 5">
    <div id="successToast" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" id="successMessage"></div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>
  
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 5">
    <div id="errorToast" class="toast align-items-center text-white bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" id="errorMessage"></div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="app.js"></script>
</body>
</html>